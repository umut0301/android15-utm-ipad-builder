# 📱 iPad Pro 部署指南 - Android 15 UTM 虚拟机

**目标设备**: iPad Pro M1 (1TB 存储)  
**UTM 版本**: 4.x 或更高  
**编译日期**: 2026-01-28  
**虚拟机包**: `UTM-VM-lineage-23.0-20260128-UNOFFICIAL-virtio_arm64.zip`

---

## 🎯 概述

本指南将帮助您将在 Debian 服务器上编译完成的 Android 15 (LineageOS 23.0) 虚拟机传输到您的 iPad Pro，并在 UTM 中成功运行。整个过程分为三个主要步骤：文件传输、虚拟机导入和配置、以及首次启动测试。

---

## 📋 前置要求

在开始之前，请确保：

- ✅ 您的 iPad Pro 上已安装 **UTM** 应用（可从 App Store 下载）
- ✅ 您的 iPad Pro 有至少 **20 GB** 的可用存储空间（用于虚拟机和扩展）
- ✅ 您的 Debian 服务器和 iPad Pro 在同一网络中（如果使用网络传输）
- ✅ 您已经成功编译了 Android 15，并且输出文件位于 `~/android/lineage/out/target/product/virtio_arm64/VirtualMachine/UTM/`

---

## 第一步：从 Debian 服务器传输文件到 iPad Pro

您需要将编译好的虚拟机 ZIP 文件传输到您的 iPad。以下是几种推荐的方法：

### 方法 1: 使用 SMB 文件共享（推荐）

这是最简单的方法，适合大文件传输。

#### 在 Debian 服务器上设置 SMB 共享

```bash
# 1. 安装 Samba
sudo apt update
sudo apt install -y samba

# 2. 创建共享目录
mkdir -p ~/utm-share
cp ~/android/lineage/out/target/product/virtio_arm64/VirtualMachine/UTM/UTM-VM-lineage-23.0-*.zip ~/utm-share/

# 3. 配置 Samba
sudo tee -a /etc/samba/smb.conf > /dev/null <<EOF

[UTM-Share]
   path = $HOME/utm-share
   browseable = yes
   read only = no
   guest ok = yes
   create mask = 0777
   directory mask = 0777
EOF

# 4. 重启 Samba 服务
sudo systemctl restart smbd

# 5. 获取服务器 IP 地址
ip addr show | grep "inet " | grep -v 127.0.0.1
```

记下您的服务器 IP 地址（例如 `192.168.1.100`）。

#### 在 iPad 上连接到 SMB 共享

1. 打开 iPad 上的 **"文件"** 应用。
2. 点击右上角的 **"..."** 按钮，选择 **"连接服务器"**。
3. 输入服务器地址：`smb://您的服务器IP`（例如 `smb://192.168.1.100`）
4. 点击 **"连接"**，选择 **"客人"** 或输入您的用户名密码。
5. 您应该能看到 `UTM-Share` 文件夹。
6. 找到 `.zip` 文件，长按并选择 **"拷贝"**。
7. 导航到 **"我的 iPad"** -> **"UTM"** 文件夹（如果没有，可以创建一个）。
8. 粘贴文件。

### 方法 2: 使用 iCloud Drive

如果您的 iCloud 有足够的空间（至少 5 GB），可以使用这个方法。

#### 在 Debian 服务器上

```bash
# 使用 rclone 上传到 iCloud Drive
# 首先需要配置 rclone（这里省略配置步骤，请参考 rclone 官方文档）
rclone copy ~/android/lineage/out/target/product/virtio_arm64/VirtualMachine/UTM/UTM-VM-lineage-23.0-*.zip icloud:UTM/
```

#### 在 iPad 上

1. 打开 **"文件"** 应用。
2. 导航到 **"iCloud Drive"** -> **"UTM"** 文件夹。
3. 等待文件下载完成（可能需要一些时间）。
4. 将文件移动到 **"我的 iPad"** 中的某个位置。

### 方法 3: 使用 HTTP 服务器（快速测试）

如果您只是想快速测试，可以在 Debian 服务器上启动一个简单的 HTTP 服务器。

#### 在 Debian 服务器上

```bash
cd ~/android/lineage/out/target/product/virtio_arm64/VirtualMachine/UTM/
python3 -m http.server 8080
```

记下您的服务器 IP 地址。

#### 在 iPad 上

1. 打开 **Safari** 浏览器。
2. 访问 `http://您的服务器IP:8080`（例如 `http://192.168.1.100:8080`）
3. 点击 `.zip` 文件下载。
4. 下载完成后，点击 **"下载"** 图标，找到文件。
5. 长按文件，选择 **"共享"** -> **"存储到文件"**。
6. 选择 **"我的 iPad"** 中的某个位置。

---

## 第二步：在 UTM 中导入虚拟机

现在，您的 `.zip` 文件已经在 iPad 上了，可以开始导入了。

### 导入步骤

1. **打开 UTM 应用**。

2. **点击右上角的 "+" 按钮**。

3. **选择 "导入"**（Import）。

4. **浏览并选择** 您刚刚传输的 `UTM-VM-lineage-23.0-20260128-UNOFFICIAL-virtio_arm64.zip` 文件。

5. **等待导入完成**。UTM 会自动解压文件并创建虚拟机。这可能需要几分钟时间。

6. **导入完成后**，您应该能在 UTM 主界面看到一个名为 **"LineageOS on arm64"** 的虚拟机。

---

## 第三步：配置虚拟机存储

在首次启动之前，**强烈建议**您根据需要调整虚拟机的存储空间。这是因为 Android 的动态分区系统会自动检测并使用您分配的所有可用空间。

### 调整存储空间

1. 在 UTM 主界面，**长按** "LineageOS on arm64" 虚拟机。

2. 选择 **"编辑"**（Edit）。

3. 在左侧菜单中，选择 **"驱动器"**（Drives）。

4. 您会看到一个名为 `disk-vda.img` 的驱动器，大小约为 **12 GB**。

5. **点击这个驱动器**。

6. 在 **"大小"**（Size）字段，输入您期望的总存储容量。推荐值：
   - **64 GB**: 适合轻度使用，安装少量应用。
   - **128 GB**: 推荐配置，适合日常使用和测试。
   - **256 GB**: 适合重度使用，安装大量应用和游戏。

   > **重要提示**: 这个大小是虚拟磁盘的总大小，包括系统分区和用户数据分区。实际可用空间会略小于这个值（因为系统分区占用约 12 GB）。

7. **点击 "保存"**（Save）。

8. **返回主界面**。

### 其他推荐配置（可选）

如果您想进一步优化性能，可以调整以下设置：

#### CPU 和内存

1. 在 "编辑" 界面，选择 **"系统"**（System）。
2. **CPU 核心数**: 建议设置为 **4-6 核**（iPad Pro M1 有 8 核，留一些给 iPadOS）。
3. **内存**: 建议设置为 **4096 MB (4 GB)** 或 **6144 MB (6 GB)**（iPad Pro M1 有 8GB 或 16GB RAM，根据您的型号调整）。

#### 显示

1. 在 "编辑" 界面，选择 **"显示"**（Display）。
2. **显卡**: 应该已经设置为 **"virtio-gpu-gl-pci"**（支持 3D 加速）。
3. **分辨率**: 可以根据您的喜好调整，推荐 **1920x1080** 或 **2048x1536**。

---

## 第四步：首次启动 Android 15

现在，一切准备就绪！让我们启动您的 Android 15 虚拟机。

### 启动步骤

1. 在 UTM 主界面，**点击** "LineageOS on arm64" 虚拟机。

2. **点击 "启动"** 按钮（播放图标）。

3. **等待启动**。首次启动可能需要 **3-5 分钟**，因为系统需要：
   - 初始化硬件
   - 扩展分区以适应您设置的磁盘大小
   - 完成首次启动优化

4. **您应该看到**：
   - LineageOS 启动动画
   - 然后是 Android 设置向导

### 完成 Android 设置向导

按照屏幕上的提示完成设置：

1. **选择语言**: 选择 "简体中文" 或您喜欢的语言。
2. **连接 Wi-Fi**: 选择您的 Wi-Fi 网络并输入密码。
3. **日期和时间**: 系统应该会自动设置，确认即可。
4. **Google 服务**（如果有）: 根据您的需要选择是否登录 Google 账户。
5. **完成设置**: 点击 "完成" 进入主屏幕。

---

## 🧪 第五步：验证关键功能

进入系统后，请验证以下关键功能是否正常工作：

### 1. 存储空间验证

- 进入 **"设置"** -> **"存储"**。
- 确认 **"内部共享存储空间"** 的总容量是否与您在 UTM 中设置的一致（例如，如果您设置了 128 GB，这里应该显示约 115 GB 可用）。

### 2. 3D 图形加速验证

- 从 Google Play（或其他应用商店）安装一个 3D 应用或游戏，例如：
  - **Asphalt 9: Legends** (赛车游戏)
  - **3DMark** (跑分软件)
  - **Antutu Benchmark** (综合跑分)
- 运行应用，检查是否有明显的卡顿或图形错误。
- 如果运行流畅，说明 3D 加速正常工作。

### 3. GPU 信息验证

- 安装 **CPU-Z** 或 **AIDA64** 应用。
- 打开应用，查看 **"GPU"** 或 **"显示"** 选项卡。
- 确认 GPU 信息显示为 **"virtio-gpu"** 或类似名称。

### 4. 网络连接验证

- 打开 **Chrome** 或其他浏览器。
- 访问任意网站，确认网络连接正常。

### 5. 基本应用验证

- 测试预装应用，例如：
  - **计算器**
  - **日历**
  - **时钟**
  - **文件管理器**
- 确认这些应用能正常打开和使用。

---

## 🎉 恭喜！

如果您完成了上述所有步骤，并且系统运行正常，那么恭喜您！您已经成功在 iPad Pro 上运行了 Android 15 (LineageOS 23.0)！

现在，您可以尽情探索和使用您的 Android 虚拟机了。

---

## 🛠️ 故障排除

如果您在部署过程中遇到问题，请参考以下常见问题和解决方案：

### 问题 1: 虚拟机无法启动，显示黑屏

**可能原因**:
- 虚拟机配置错误
- 显卡设置不正确

**解决方案**:
1. 编辑虚拟机设置。
2. 进入 "显示" 选项卡。
3. 确认显卡设置为 **"virtio-gpu-gl-pci"**。
4. 如果仍然无法启动，尝试将显卡临时改为 **"virtio-ramfb"**（无 3D 加速，但更稳定）。

### 问题 2: 存储空间没有扩展到我设置的大小

**可能原因**:
- 首次启动时分区扩展失败
- 需要手动触发扩展

**解决方案**:
1. 进入 Android 系统。
2. 打开 **"设置"** -> **"关于手机"**。
3. 多次点击 **"版本号"** 以启用 **"开发者选项"**。
4. 返回 "设置"，进入 **"系统"** -> **"开发者选项"**。
5. 找到并启用 **"USB 调试"**。
6. 使用 `adb` 连接到虚拟机（需要在 iPad 上配置端口转发，这超出了本指南的范围）。
7. 运行 `adb shell sm partition disk:179,0 private` 来手动触发分区扩展。

**更简单的方法**:
- 重新启动虚拟机，系统通常会在第二次启动时自动完成扩展。

### 问题 3: 3D 应用运行卡顿或崩溃

**可能原因**:
- 分配的 CPU 或内存不足
- 3D 加速驱动问题

**解决方案**:
1. 编辑虚拟机设置，增加 CPU 核心数和内存。
2. 确认显卡设置为 **"virtio-gpu-gl-pci"**。
3. 在 UTM 的 "QEMU" 选项卡中，确认 **"ANGLE (Metal)"** 已启用。

### 问题 4: 无法连接到 Wi-Fi

**可能原因**:
- UTM 网络配置问题

**解决方案**:
1. 编辑虚拟机设置。
2. 进入 **"网络"** 选项卡。
3. 确认网络模式设置为 **"共享网络"**（Shared Network）或 **"桥接"**（Bridged）。
4. 保存并重启虚拟机。

---

## 📞 获取帮助

如果您遇到了本指南未涵盖的问题，可以：

1. 查看项目的 [故障排除指南](./TROUBLESHOOTING_GUIDE.md)。
2. 查看项目的 [常见问题解答](./FAQ.md)。
3. 在 GitHub 仓库中提交 Issue: https://github.com/umut0301/android15-utm-ipad-builder/issues

---

**祝您使用愉快！** 🎉
