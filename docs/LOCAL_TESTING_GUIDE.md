# æœ¬åœ°æµ‹è¯•æŒ‡å— - UTM å­˜å‚¨æ‰©å±•å·¥å…·

**ç›®æ ‡**: åœ¨æ‚¨çš„æœ¬åœ° Debian æœåŠ¡å™¨ä¸Šå®‰å…¨åœ°æµ‹è¯• `utm-storage-resizer.sh` è„šæœ¬ã€‚

---

## ğŸ¯ æµ‹è¯•ç›®çš„

åœ¨å¯¹æ‚¨å®è´µçš„ã€èŠ±è´¹æ•°å°æ—¶ç¼–è¯‘å‡ºæ¥çš„ UTM è™šæ‹ŸæœºåŒ…è¿›è¡Œæ“ä½œä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆç”¨ä¸€ä¸ª**å®‰å…¨çš„ã€æ¨¡æ‹Ÿçš„**ç¯å¢ƒæ¥éªŒè¯è„šæœ¬çš„æ‰€æœ‰åŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚è¿™å°†ç¡®ä¿ï¼š

- âœ… è„šæœ¬èƒ½æ­£ç¡®è¯†åˆ«å’Œå¤„ç†æ‚¨çš„ç¯å¢ƒã€‚
- âœ… æ‰€æœ‰ä¾èµ–é¡¹éƒ½å·²æ­£ç¡®å®‰è£…ã€‚
- âœ… ç£ç›˜æ‰©å±•å’Œé…ç½®æ–‡ä»¶ä¿®æ”¹é€»è¾‘æ— è¯¯ã€‚
- âœ… æ‚¨ç†Ÿæ‚‰è„šæœ¬çš„äº¤äº’æµç¨‹å’Œè¾“å‡ºã€‚

---

## ğŸ“‹ æµ‹è¯•ç¯å¢ƒå‡†å¤‡ (5 åˆ†é’Ÿ)

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå®Œå…¨æ— å®³çš„ã€æ¨¡æ‹Ÿçš„ UTM åŒ…ç»“æ„æ¥è¿›è¡Œæµ‹è¯•ã€‚

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºæµ‹è¯•ç›®å½•

åœ¨æ‚¨çš„ Debian æœåŠ¡å™¨ä¸Šï¼Œæ‰“å¼€ä¸€ä¸ªç»ˆç«¯å¹¶è¿è¡Œï¼š

```bash
# åˆ›å»ºä¸€ä¸ªä¸“é—¨çš„æµ‹è¯•æ–‡ä»¶å¤¹
mkdir -p ~/utm-test-environment
cd ~/utm-test-environment
```

### ç¬¬äºŒæ­¥ï¼šåˆ›å»ºæ¨¡æ‹Ÿçš„ .utm ç›®å½•ç»“æ„

```bash
# åˆ›å»ºæ¨¡æ‹Ÿçš„ .utm ç›®å½•å’Œ Images å­ç›®å½•
mkdir -p Mock_Android.utm/Images
```

### ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ¨¡æ‹Ÿçš„é…ç½®æ–‡ä»¶ (config.plist)

```bash
# åˆ›å»ºä¸€ä¸ªç²¾ç®€ç‰ˆçš„ config.plist
cat > Mock_Android.utm/config.plist << EOF
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>Drive</key>
    <array>
        <dict>
            <key>ImageName</key>
            <string>disk-vda.img</string>
            <key>ImageType</key>
            <string>Disk</string>
            <key>Interface</key>
            <string>virtio</string>
            <key>SizeMib</key>
            <integer>12288</integer>  <!-- æ¨¡æ‹Ÿ 12GB -->
        </dict>
    </array>
</dict>
</plist>
EOF
```

### ç¬¬å››æ­¥ï¼šåˆ›å»ºæ¨¡æ‹Ÿçš„è™šæ‹Ÿç£ç›˜ (disk-vda.img)

æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå¾ˆå°çš„ï¼ˆ10MBï¼‰æ–‡ä»¶æ¥æ¨¡æ‹Ÿ 12GB çš„è™šæ‹Ÿç£ç›˜ã€‚è¿™è¶³ä»¥æµ‹è¯•è„šæœ¬çš„é€»è¾‘ï¼Œè€Œä¸”é€Ÿåº¦éå¸¸å¿«ã€‚

```bash
# åˆ›å»ºä¸€ä¸ª 10MB çš„ç©ºæ–‡ä»¶ä½œä¸ºæ¨¡æ‹Ÿç£ç›˜
truncate -s 10M Mock_Android.utm/Images/disk-vda.img
```

### ç¬¬äº”æ­¥ï¼šåˆ›å»ºæ¨¡æ‹Ÿçš„ .zip åŒ… (å¯é€‰)

å¦‚æœæ‚¨æƒ³æµ‹è¯•è„šæœ¬å¤„ç† .zip æ–‡ä»¶çš„èƒ½åŠ›ï¼Œå¯ä»¥æŠŠæˆ‘ä»¬åˆšåˆ›å»ºçš„æ¨¡æ‹Ÿ .utm ç›®å½•æ‰“åŒ…ã€‚

```bash
zip -r Mock_Android_VM.zip Mock_Android.utm
```

### ç¬¬å…­æ­¥ï¼šæ£€æŸ¥æµ‹è¯•ç¯å¢ƒ

è¿è¡Œ `ls -R`ï¼Œæ‚¨åº”è¯¥çœ‹åˆ°å¦‚ä¸‹ç»“æ„ï¼š

```
.:
Mock_Android.utm  Mock_Android_VM.zip

./Mock_Android.utm:
config.plist  Images

./Mock_Android.utm/Images:
disk-vda.img
```

ç°åœ¨ï¼Œæ‚¨çš„å®‰å…¨æµ‹è¯•ç¯å¢ƒå·²ç»å‡†å¤‡å°±ç»ªï¼

---

## ğŸš€ æ‰§è¡Œæµ‹è¯• (10 åˆ†é’Ÿ)

### ç¬¬ä¸€æ­¥ï¼šè·å–æœ€æ–°çš„è„šæœ¬

é¦–å…ˆï¼Œä» GitHub æ‹‰å–æœ€æ–°çš„ä»£ç ï¼Œç¡®ä¿æ‚¨æ‹¥æœ‰ `utm-storage-resizer.sh` è„šæœ¬ã€‚

```bash
# è¿›å…¥æ‚¨çš„é¡¹ç›®ä»“åº“ç›®å½•
cd ~/android15-utm-ipad-builder

# æ‹‰å–æœ€æ–°æ›´æ–°
git pull
```

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œè„šæœ¬è¿›è¡Œæµ‹è¯•

ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æ–°è„šæœ¬æ¥å¤„ç†æˆ‘ä»¬åˆ›å»ºçš„**æ¨¡æ‹Ÿ UTM åŒ…**ã€‚

```bash
# åˆ‡æ¢åˆ°æµ‹è¯•ç¯å¢ƒç›®å½•
cd ~/utm-test-environment

# ä»¥ sudo æƒé™è¿è¡Œè„šæœ¬ï¼ˆè„šæœ¬éœ€è¦ root æ¥å®‰è£…ä¾èµ–å’Œæ“ä½œæ–‡ä»¶ï¼‰
# ä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç›¸å¯¹è·¯å¾„æŒ‡å‘è„šæœ¬
sudo bash ~/android15-utm-ipad-builder/tools/utm-storage-resizer.sh
```

### ç¬¬ä¸‰æ­¥ï¼šäº¤äº’å¼æµ‹è¯•æµç¨‹

è„šæœ¬å¯åŠ¨åï¼Œæ‚¨å°†è¿›å…¥äº¤äº’å¼ç•Œé¢ã€‚è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1.  **é€‰æ‹©åŒ…**: 
    - è„šæœ¬ä¼šåˆ—å‡º `Mock_Android.utm` å’Œ `Mock_Android_VM.zip`ã€‚
    - **é€‰æ‹© `[1] ./Mock_Android.utm`** æ¥æµ‹è¯•å¯¹ç›®å½•çš„æ“ä½œã€‚

2.  **é€‰æ‹©å¤§å°**: 
    - è„šæœ¬ä¼šæä¾› 64/128/256 GB çš„é€‰é¡¹ã€‚
    - **é€‰æ‹© `[2] 128 GB`**ã€‚

3.  **ç¡®è®¤æ“ä½œ**: 
    - è„šæœ¬ä¼šæ˜¾ç¤ºå®ƒå°†è¦æ‰§è¡Œçš„æ“ä½œè®¡åˆ’ã€‚
    - è¾“å…¥ `y` å¹¶æŒ‰ Enter ç¡®è®¤ã€‚

### ç¬¬å››æ­¥ï¼šè§‚å¯Ÿè¾“å‡º

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ç±»ä¼¼ä»¥ä¸‹çš„æ—¥å¿—è¾“å‡ºï¼š

```
[INFO] å¼€å§‹å¤„ç†...
[INFO] æ‰©å±•ç£ç›˜é•œåƒ: Mock_Android.utm/Images/disk-vda.img
[INFO] ç›®æ ‡å¤§å°: 128 GB
[INFO] åˆ›å»ºå¤‡ä»½...
[INFO] æ‰©å±•è™šæ‹Ÿç£ç›˜...
[SUCCESS] ç£ç›˜é•œåƒå·²æ‰©å±•åˆ° 128 GB
[INFO] æ‰©å±• GPT åˆ†åŒºè¡¨...
[SUCCESS] åˆ†åŒºè¡¨å·²æ‰©å±•
[INFO] æ›´æ–° UTM é…ç½®æ–‡ä»¶...
[SUCCESS] é…ç½®æ–‡ä»¶å·²æ›´æ–°: SizeMib = 131072 MiB (128 GB)
[SUCCESS] å¤„ç†å®Œæˆï¼
```

---

## ğŸ” éªŒè¯æµ‹è¯•ç»“æœ

æµ‹è¯•å®Œæˆåï¼Œæˆ‘ä»¬éœ€è¦éªŒè¯è„šæœ¬æ˜¯å¦æ­£ç¡®åœ°ä¿®æ”¹äº†æ–‡ä»¶ã€‚

### ç¬¬ä¸€æ­¥ï¼šæ£€æŸ¥è™šæ‹Ÿç£ç›˜å¤§å°

```bash
# æŸ¥çœ‹æ¨¡æ‹Ÿç£ç›˜çš„è™šæ‹Ÿå¤§å°
qemu-img info Mock_Android.utm/Images/disk-vda.img
```

**é¢„æœŸè¾“å‡º**: 
```
image: Mock_Android.utm/Images/disk-vda.img
file format: raw
virtual size: 128 GiB (137438953472 bytes)
...
```

### ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥é…ç½®æ–‡ä»¶

```bash
# æŸ¥çœ‹ config.plist ä¸­ SizeMib çš„å€¼
cat Mock_Android.utm/config.plist | grep SizeMib -A 1
```

**é¢„æœŸè¾“å‡º**: 
```xml
<key>SizeMib</key>
<integer>131072</integer>
```

### ç¬¬ä¸‰æ­¥ï¼šæ£€æŸ¥å¤‡ä»½

```bash
# ç¡®è®¤å¤‡ä»½æ–‡ä»¶å·²åˆ›å»º
ls -lh Mock_Android.utm/Images/*.backup
ls -lh Mock_Android.utm/*.backup
```

æ‚¨åº”è¯¥èƒ½çœ‹åˆ° `disk-vda.img.backup` å’Œ `config.plist.backup` æ–‡ä»¶ã€‚

---

##  Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğµ Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ (Retesting) - æµ‹è¯• ZIP æ–‡ä»¶

å¦‚æœæ‚¨æƒ³è¿›ä¸€æ­¥æµ‹è¯•ï¼Œå¯ä»¥é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œä½†åœ¨é€‰æ‹©åŒ…æ—¶é€‰æ‹© `Mock_Android_VM.zip`ã€‚

```bash
# å†æ¬¡è¿è¡Œè„šæœ¬
sudo bash ~/android15-utm-ipad-builder/tools/utm-storage-resizer.sh
```

- **é€‰æ‹©åŒ…**: `[2] ./Mock_Android_VM.zip`
- **é€‰æ‹©å¤§å°**: `[3] 256 GB`

æµ‹è¯•å®Œæˆåï¼Œæ‚¨åº”è¯¥ä¼šåœ¨å½“å‰ç›®å½•çœ‹åˆ°ä¸€ä¸ªåä¸º `Mock_Android_VM-256GB.zip` çš„æ–°æ–‡ä»¶ã€‚

---

## âœ… æ€»ç»“

å¦‚æœä»¥ä¸Šæ‰€æœ‰æ­¥éª¤éƒ½æˆåŠŸå®Œæˆï¼Œå¹¶ä¸”éªŒè¯ç»“æœä¸é¢„æœŸä¸€è‡´ï¼Œé‚£ä¹ˆæ­å–œæ‚¨ï¼`utm-storage-resizer.sh` è„šæœ¬åœ¨æ‚¨çš„ç³»ç»Ÿä¸Šè¿è¡Œè‰¯å¥½ã€‚

ç°åœ¨ï¼Œæ‚¨å¯ä»¥æ”¾å¿ƒåœ°ç”¨å®ƒæ¥å¤„ç†æ‚¨çœŸæ­£çš„ Android 15 è™šæ‹ŸæœºåŒ…äº†ã€‚

### æ¸…ç†æµ‹è¯•ç¯å¢ƒ

æµ‹è¯•å®Œæˆåï¼Œæ‚¨å¯ä»¥åˆ é™¤æµ‹è¯•ç›®å½•ï¼š

```bash
rm -rf ~/utm-test-environment
```
