# 💾 UTM 虚拟机存储扩展完整指南

**适用于**: iPad Pro + UTM + Android 15 虚拟机  
**目标**: 正确扩展虚拟磁盘从 12GB 到 64GB/128GB/256GB

---

## 📋 前言

许多用户在尝试扩展 UTM 虚拟机的存储空间时会遇到困惑，因为 UTM 的界面设计与传统虚拟化软件（如 VirtualBox 或 VMware）有所不同。本指南将详细说明在 iPad 上如何正确地为 Android 15 虚拟机扩展存储空间。

---

## 🎯 核心概念

在 UTM 中，虚拟磁盘的大小调整**必须在虚拟机停止状态下**，通过**编辑虚拟机配置**来完成。您不能在虚拟机运行时调整大小，也不能在文件管理器中直接修改磁盘镜像文件。

### 为什么需要扩展存储？

编译输出的 Android 15 虚拟机默认使用 **12GB** 的虚拟磁盘。这个大小包括：
- **系统分区** (约 12GB): 包含 Android 操作系统、预装应用和系统库。
- **用户数据分区** (几乎没有): 默认情况下，用户可用空间非常有限。

如果您想安装应用、存储照片、下载文件等，您需要扩展虚拟磁盘到更大的容量，例如 **128GB**。Android 的动态分区系统会自动检测到额外的空间，并将其分配给用户数据分区。

---

## ✅ 正确的扩展流程

### 前提条件

- ✅ 虚拟机已成功导入到 UTM
- ✅ 虚拟机处于**停止状态**（未运行）
- ✅ 您知道想要设置的目标大小（推荐 128GB）

### 步骤 1: 进入虚拟机编辑模式

1.  打开 iPad 上的 **UTM** 应用。
2.  在虚拟机列表中，找到您的 Android 15 虚拟机（通常名为 "LineageOS on arm64"）。
3.  **确保虚拟机未运行**。如果正在运行，请先停止它。
4.  **长按虚拟机图标**，在弹出的菜单中选择 **"编辑"** (Edit)。

### 步骤 2: 导航到驱动器设置

1.  在虚拟机编辑界面，左侧会显示一个设置类别菜单。
2.  点击 **"驱动器"** (Drives) 选项卡。

### 步骤 3: 识别主虚拟磁盘

在 "驱动器" 界面，您会看到一个或多个驱动器的列表。对于我们的 Android 15 虚拟机，关键的驱动器是：

| 驱动器名称 | 类型 | 默认大小 | 说明 |
|---|---|---|---|
| `disk-vda.img` | VirtIO | 12 GB | **主系统磁盘** - 这是您需要扩展的 |
| (可能还有其他) | CD-ROM 等 | - | 不要修改这些 |

**找到 `disk-vda.img`** 或名称类似的主磁盘驱动器。它的大小应该显示为 **12 GB** 或 **12288 MB**。

### 步骤 4: 修改磁盘大小

1.  **点击** `disk-vda.img` 驱动器。会弹出一个详细配置窗口。
2.  在这个窗口中，找到 **"大小"** (Size) 字段。根据 UTM 的版本，它可能显示为：
    *   **"大小 (MB)"** - 单位是兆字节
    *   **"大小 (GB)"** - 单位是吉字节
    *   或者一个可以滑动的滑块

3.  **输入或选择新的大小**：

    | 目标容量 | 输入值 (如果单位是 MB) | 输入值 (如果单位是 GB) |
    |---|---|---|
    | 64 GB | `65536` | `64` |
    | 128 GB | `131072` | `128` |
    | 256 GB | `262144` | `256` |

    **推荐值**: `128 GB` (131072 MB)

4.  **确认修改**: 点击窗口中的 **"保存"** 或 **"完成"** 按钮。

### 步骤 5: 保存虚拟机配置

1.  返回虚拟机编辑的主界面。
2.  点击右上角的 **"保存"** (Save) 按钮。
3.  UTM 会应用您的更改并返回到虚拟机列表。

### 步骤 6: 启动虚拟机并验证

1.  **启动虚拟机**: 点击虚拟机图标上的播放按钮。
2.  **首次启动会较慢**: Android 系统需要检测到新的磁盘大小，并扩展文件系统。这个过程可能需要 **3-5 分钟**，请耐心等待。
3.  **进入系统**: 完成 Android 设置向导（如果是首次启动）。
4.  **验证存储空间**:
    *   进入 **"设置"** -> **"存储"**。
    *   查看 **"内部共享存储空间"** 的总容量。
    *   如果您设置了 128 GB，这里应该显示大约 **115 GB** 左右（因为系统分区占用了约 12 GB，并且存储容量计算方式略有不同）。

---

## 🔍 常见问题和解决方案

### 问题 1: 我找不到 "编辑" 选项

**原因**: 您可能在虚拟机运行时尝试编辑。

**解决方案**: 
1.  先停止虚拟机（点击虚拟机，然后点击停止按钮）。
2.  返回虚拟机列表，再次长按虚拟机图标，"编辑" 选项应该会出现。

### 问题 2: 我看不到 "大小" 字段

**原因**: UTM 的不同版本界面略有不同。

**解决方案**: 
1.  确保您点击的是 `disk-vda.img` 驱动器本身，而不是驱动器列表的空白区域。
2.  在弹出的配置窗口中，仔细查找 "Size"、"Capacity"、"容量" 或类似的字段。
3.  如果实在找不到，尝试更新 UTM 到最新版本。

### 问题 3: 修改后，Android 系统中的存储空间没有变化

**原因**: Android 系统可能需要手动触发分区扩展，或者您没有等待足够长的时间。

**解决方案**: 
1.  **重启虚拟机**: 完全关闭虚拟机，然后重新启动。Android 通常会在第二次启动时完成分区扩展。
2.  **等待更长时间**: 首次启动后，给系统至少 5-10 分钟来完成后台任务。
3.  **检查 UTM 配置**: 返回 UTM，再次进入 "编辑" -> "驱动器"，确认 `disk-vda.img` 的大小确实已经改变。

### 问题 4: UTM 提示 "无法调整大小" 或类似错误

**原因**: 虚拟磁盘可能正在被使用，或者文件系统有问题。

**解决方案**: 
1.  **完全关闭 UTM 应用**: 从 iPad 的应用切换器中划掉 UTM，然后重新打开。
2.  **删除并重新导入**: 如果问题持续，删除虚拟机（包括驱动器镜像），然后重新从 `.zip` 文件导入，并在首次启动前就修改大小。

---

## 💡 最佳实践

1.  **在首次启动前扩展**: 最理想的时机是在导入虚拟机后、首次启动前就设置好存储大小。这样可以避免后续的分区调整问题。
2.  **不要过度分配**: 虽然 iPad Pro 有 1TB 存储，但虚拟磁盘会占用实际的物理空间。如果您设置了 256 GB，UTM 最终会使用接近 256 GB 的 iPad 存储。
3.  **定期备份**: 在调整存储大小或进行重大配置更改前，考虑导出虚拟机作为备份。

---

## 📊 存储大小推荐

根据您的使用场景，选择合适的存储大小：

| 使用场景 | 推荐大小 | 说明 |
|---|---|---|
| **轻度测试** | 64 GB | 适合只安装少量应用，主要用于测试系统功能 |
| **日常使用** | 128 GB | **推荐配置**，可以安装大量应用、游戏，存储照片和文件 |
| **重度使用** | 256 GB | 适合安装大型游戏、存储大量媒体文件，或作为主要 Android 环境 |

---

## 🎉 总结

在 UTM 中扩展 Android 15 虚拟机的存储空间，关键步骤是：

1.  停止虚拟机
2.  进入 "编辑" -> "驱动器"
3.  点击 `disk-vda.img` 并修改 "大小"
4.  保存配置
5.  启动虚拟机并等待分区扩展完成

只要按照这些步骤操作，您就能成功地为您的 Android 虚拟机提供充足的存储空间。祝您使用愉快！
